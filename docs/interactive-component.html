<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Interactive component | VIX Analysis</title>
  <meta name="description" content="Chapter 6 Interactive component | VIX Analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Interactive component | VIX Analysis" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Interactive component | VIX Analysis" />
  
  
  

<meta name="author" content="Alex Saunders &amp; Masataka Koga" />


<meta name="date" content="2021-12-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="results.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">VIX Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-sources.html"><a href="data-sources.html#vix-data"><i class="fa fa-check"></i><b>2.1</b> VIX data</a></li>
<li class="chapter" data-level="2.2" data-path="data-sources.html"><a href="data-sources.html#stock-indices"><i class="fa fa-check"></i><b>2.2</b> Stock indices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">VIX Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive-component" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Interactive component</h1>
<h1>
Scatter plot for VIX vs the US Stock Market
</h1>
<div id="my_dataviz">

</div>
<p><button type="button" onclick="add()">Same day</button>
<button type="button" onclick="remove()">Next Day</button></p>
<p>
In this interactive chart we show the difference between the same day relationship between the VIX and the market - strongly negative. And the Next Day relationship which is less clear.
Click the buttons to click between the two charts.
</p>
<p>
If you are interested in specific dates, you can hover over the points to show the date and click on an observation to put the date on the scatter
</p>
<p>
Linear regression functionality from <a href="https://bl.ocks.org/HarryStevens/be559bed98d662f69e68fc8a7e0ad097>"> Harry Stevens</a>
</p>
<p>
<p>Finally to complement Masaâ€™s work on looking at negative returns you may use the radio buttons to highlight the difference between the positive market returns and negative market returns. By selecting these options the relevant points will be coloured green or red for positive and negative reutnrs.</p>
<p><input type="checkbox" id="Pos" onclick = "highlight()">
<label for="Pos">Highlight Positive Returns</label>
<input type="checkbox" id="Neg" onclick = "highlight()">
<label for="Neg">Highlight Negative Returns</label></p>
<script src="https://d3js.org/d3.v7.js"></script>
<script>

// set the dimensions and margins of the graph
  var margin = {top: 10, right: 30, bottom: 30, left: 60},
    width = 860 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;
  padding = 20

  var svg = d3.select("#my_dataviz")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

  var rowConverter = function(d) {
   return {
    DATE : d.DATE,
    CLOSE : d.CLOSE,
    dVIX : parseFloat(d.dVIX),
    dVIX_t1 : parseFloat(d.dVIX_t1),
    MktRF: parseFloat(d.MktRF),
   };
  }


d3.csv("https://raw.githubusercontent.com/alexnsaunders/VIXanalysis/main/df2_small.csv",rowConverter).then( function(data) {
  VIX = data
   
  // Add X axis
  padding = 20
  var x = d3.scaleLinear()
    .domain([d3.min(VIX,function(d) {return d.dVIX;}), d3.max(VIX,function(d) {return d.dVIX;})])
    .range([ padding, width - padding ]);
  svg.append("g")
    .attr("transform", "translate(0," + (height - padding) + ")")
    .call(d3.axisBottom(x));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([d3.min(VIX,function(d) {return d.MktRF;}), d3.max(VIX,function(d) {return d.MktRF;})])
    .range([ height, 0]);
  svg.append("g")
    .attr("transform", "translate(" + padding + ",0)")
    .call(d3.axisLeft(y));
    
      svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left)
      .attr("x",0 - (height / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Market return 1d (%)"); 
      
        svg.append("text")             
      .attr("transform",
            "translate(" + (width/2) + " ," + 
                           (height + margin.top + 5) + ")")
      .style("text-anchor", "middle")
      .text("VIX Change 1d in pts");

  // Add dots
  svg.append('g')
    .selectAll("dot")
    .data(data)
    .enter()
    .append("circle")
      .attr("cx", function (d) { return x(d.dVIX); } )
      .attr("cy", function (d) { return y(d.MktRF); } )
      .attr("r", 3)
      .attr("fill","blue")
      .attr("date",function (d) { return d.DATE; })
      .append("title")
      .text(function (d) { return d.DATE; });

   lg = calcLinear(VIX, "dVIX", "MktRF", d3.min(VIX, function(d){ return d.dVIX}), d3.min(VIX, function(d){ return d.MktRF}))  
   
   svg
   .append("line")
   .attr("id","reg_line")
            .attr("x1", x(lg.ptA.x))
            .attr("y1", y(lg.ptA.y))
            .attr("x2", x(lg.ptB.x))
            .attr("y2", y(lg.ptB.y))
            .attr("stroke","red") 
  
  svg.append("text")
         .attr("id","reg_text")
         .attr("x", x(lg.ptA.x))
         .attr("y", y(lg.ptA.y))
         .text("Regression y = " +Math.round( lg.Reg.m*100)/100 +"x + "+Math.round(lg.Reg.b*100)/100)
         
  d3.selectAll("circle")
    .on("click", function (event) {
      d3.select("svg")
      .append("text")
      .attr("id","click_text")
      .attr("x",d3.pointer(event).map(Math.round)[0])
      .attr("y",d3.pointer(event).map(Math.round)[1])
      .text(d3.select(this).attr("date"))
      ;
      });
    
})
  
function highlight() {
if (d3.select("input#Pos").property('checked')) {
svg.selectAll("circle").filter(function(d) {
  return d.MktRF > 0;}).transition()
  .duration(1000).
  attr("fill","green")
  }
  else { svg.selectAll("circle").filter(function(d) {
  return d.MktRF > 0;}).transition()
  .duration(1000)
  .attr("fill","blue")
  }
if (d3.select("input#Neg").property('checked'))  {
  svg.selectAll("circle").filter(function(d) {
  return d.MktRF < 0;}).transition()
  .duration(1000)
  .attr("fill","red")
  }
  else { svg.selectAll("circle").filter(function(d) {
  return d.MktRF < 0;}).transition()
  .duration(1000)
  .attr("fill","blue")
  }
}


function add() {
  
  
  d3.selectAll("text#click_text").remove()
  
   padding = 20
  var x = d3.scaleLinear()
    .domain([d3.min(VIX,function(d) {return d.dVIX;}), d3.max(VIX,function(d) {return d.dVIX;})])
    .range([ padding, width - padding ]);
  svg.append("g")
    .attr("transform", "translate(0," + (height - padding) + ")")
    .call(d3.axisBottom(x));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([d3.min(VIX,function(d) {return d.MktRF;}), d3.max(VIX,function(d) {return d.MktRF;})])
    .range([ height, 0]);
  svg.append("g")
    .attr("transform", "translate(" + padding + ",0)")
    .call(d3.axisLeft(y));
  
      svg.selectAll("circle")
      .transition().duration(2000)
      .attr("cx", function (d) { return x(d.dVIX); } )
      .attr("cy", function (d) { return y(d.MktRF); } );
     
      var lg = calcLinear(VIX, "dVIX", "MktRF", d3.min(VIX, function(d){ return d.dVIX}), d3.min       (VIX, function(d){ return d.MktRF}))  
  
        svg.selectAll("line#reg_line")
        .transition().duration(2000)
            .attr("x1", x(lg.ptA.x))
            .attr("y1", y(lg.ptA.y))
            .attr("x2", x(lg.ptB.x))
            .attr("y2", y(lg.ptB.y))
            .attr("stroke","red") 
      
    svg.selectAll("text#reg_text")
      .transition()
         .duration(2000)
         .attr("id","reg_text")
         .attr("x", x(lg.ptA.x))
         .attr("y", y(lg.ptA.y))         
         .text("Regression y = " +Math.round( lg.Reg.m*100)/100 +"x + "+Math.round(lg.Reg.b*100)/100)

    
  
}

function remove() {
  
  d3.selectAll("text#click_text").remove()
  var x = d3.scaleLinear()
    .domain([d3.min(VIX,function(d) {return d.dVIX;}), d3.max(VIX,function(d) {return d.dVIX;})])
    .range([ padding, width - padding ]);
  svg.append("g")
    .attr("transform", "translate(0," + (height - padding) + ")")
    .call(d3.axisBottom(x));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([d3.min(VIX, function(d) {return d.MktRF;}), d3.max(VIX,function(d) {return d.MktRF;})])
    .range([ height, 0]);
  svg.append("g")
    .attr("transform", "translate(" + padding + ",0)")
    .call(d3.axisLeft(y));
  
  
      svg.selectAll("circle")
      .transition().duration(2000)
      .attr("cx", function (d) { return x(d.dVIX_t1); } )
      .attr("cy", function (d) { return y(d.MktRF); } );
      
        var lg = calcLinear(VIX, "dVIX_t1", "MktRF", d3.min(VIX, function(d){ return d.dVIX_t1}), d3.min(VIX, function(d){ return d.MktRF}))  
  
        svg.selectAll("line#reg_line")
        .transition().duration(2000)
            .attr("x1", x(lg.ptA.x))
            .attr("y1", y(lg.ptA.y))
            .attr("x2", x(lg.ptB.x))
            .attr("y2", y(lg.ptB.y))
            .attr("stroke","red")
            
         svg.selectAll("text#reg_text")
      .transition()
         .duration(2000)
         .attr("id","reg_text")
         .attr("x", x(lg.ptA.x))
         .attr("y", y(lg.ptA.y))
         .text("Regression y = " +Math.round( lg.Reg.m*100)/100 +"x + "+Math.round(lg.Reg.b*100)/100)
  
}



function calcLinear(data, x, y, minX, minY){
  /////////
  //SLOPE//
  /////////

  // Let n = the number of data points
  var n = data.length;

  var pts = [];
  data.forEach(function(d,i){
    var obj = {};
    obj.x = d[x];
    obj.y = d[y];
    obj.mult = obj.x*obj.y;
    pts.push(obj);
  });

  // Let a equal n times the summation of all x-values multiplied by their corresponding y-values
  // Let b equal the sum of all x-values times the sum of all y-values
  // Let c equal n times the sum of all squared x-values
  // Let d equal the squared sum of all x-values
  var sum = 0;
  var xSum = 0;
  var ySum = 0;
  var sumSq = 0;
  pts.forEach(function(pt){
    sum = sum + pt.mult;
    xSum = xSum + pt.x;
    ySum = ySum + pt.y;
    sumSq = sumSq + (pt.x * pt.x);
  });
  var a = sum * n;
  var b = xSum * ySum;
  var c = sumSq * n;
  var d = xSum * xSum;

  // Plug the values that you calculated for a, b, c, and d into the following equation to calculate the slope
  //  m = (a - b) / (c - d)
  var m = (a - b) / (c - d);

  /////////////
  //INTERCEPT//
  /////////////

  // Let e equal the sum of all y-values
  var e = ySum;

  // Let f equal the slope times the sum of all x-values
  var f = m * xSum;

  // Plug the values you have calculated for e and f into the following equation for the y-intercept
  // y-intercept = b = (e - f) / n = (14.5 - 10.5) / 3 = 1.3
  var b = (e - f) / n;

  // return an object of two points
  // each point is an object with an x and y coordinate
  return {
    ptA : {
      x: minX,
      y: m * minX + b
    },
    ptB : {
      y: minY,
      x: (minY - b) / m
    },
    Reg : {
      m: m,
      b: b
    }
    
  }

}
</script>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/alexnsaunders/VIXanalysis/edit/main/06-interactive.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/alexnsaunders/VIXanalysis/blob/main/06-interactive.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
